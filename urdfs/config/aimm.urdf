<?xml version="1.0" encoding="utf-8"?>
<robot name="AIMM" xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- Base link -->
  <link name="base_link"/>

  <!-- Left Battery -->
  <link name="left_battery_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 -0.52 -0.2"/>
      <geometry>
        <mesh filename="package://autonomy_boat/models/battery/mesh/battery.dae" scale="0.5 0.5 0.5"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="-0.7 0.05 0.05"/>
      <geometry>
        <box size="0.3 0.2 0.15"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0.15"/>
      <mass value="10"/>
      <inertia ixx="0.06366" ixy="0" ixz="0" iyy="0.11553" iyz="0" izz="0.128338"/>
    </inertial>
  </link>

  <joint name="left_chasis_battery_joint" type="fixed">
    <origin rpy="0 0 0" xyz="-1.5 0.2 -0.1"/>
    <parent link="base_link"/>
    <child link="left_battery_link"/>
  </joint>

  <!-- Right Battery (same as left with different joint origin) -->
  <link name="right_battery_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 -0.52 -0.2"/>
      <geometry>
        <mesh filename="package://autonomy_boat/models/battery/mesh/battery.dae" scale="0.5 0.5 0.5"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="-0.7 0.05 0.05"/>
      <geometry>
        <box size="0.3 0.2 0.15"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0.15"/>
      <mass value="10"/>
      <inertia ixx="0.06366" ixy="0" ixz="0" iyy="0.11553" iyz="0" izz="0.128338"/>
    </inertial>
  </link>

  <joint name="right_chasis_battery_joint" type="fixed">
    <origin rpy="0 0 0" xyz="-1.5 -0.2 -0.1"/>
    <parent link="base_link"/>
    <child link="right_battery_link"/>
  </joint>

  <!-- AIMM Base Link with visual, collisions, and inertial -->
  <link name="aimm_base_link">
    <visual>
      <origin rpy="0 0 3.14" xyz="0 0 -0.6"/>
      <geometry>
        <mesh filename="package://autonomy_boat/models/aimm-base/mesh/AIMMBoat.dae" scale="0.026 0.026 0.026"/>
      </geometry>
    </visual>

    <!-- Multiple collisions (floats, beams, base) -->
    <collision name="left_float">
      <origin rpy="0 1.57 0" xyz="-0.15 0.575 0.21"/>
      <geometry>
        <cylinder length="2.1" radius="0.21"/>
      </geometry>
    </collision>
    <collision name="left_front_float">
      <origin rpy="0 1.38 0" xyz="0.75 0.575 0.25"/>
      <geometry>
        <cylinder length="0.8" radius="0.17"/>
      </geometry>
    </collision>
    <collision name="left_beam">
      <origin rpy="0 0 0" xyz="-0.09 0.585 0.52"/>
      <geometry>
        <box size="2.23 0.07 0.2"/>
      </geometry>
    </collision>
    <collision name="right_float">
      <origin rpy="0 1.57 0" xyz="-0.15 -0.575 0.21"/>
      <geometry>
        <cylinder length="2.1" radius="0.21"/>
      </geometry>
    </collision>
    <collision name="right_front_float">
      <origin rpy="0 1.38 0" xyz="0.75 -0.575 0.25"/>
      <geometry>
        <cylinder length="0.8" radius="0.17"/>
      </geometry>
    </collision>
    <collision name="right_beam">
      <origin rpy="0 0 0" xyz="-0.09 -0.585 0.52"/>
      <geometry>
        <box size="2.23 0.07 0.2"/>
      </geometry>
    </collision>
    <collision name="top_base">
      <origin rpy="0 0 0" xyz="-0.09 0 0.59"/>
      <geometry>
        <box size="2.23 1.24 0.08"/>
      </geometry>
    </collision>

    <inertial>
      <mass value="160"/>
      <inertia ixx="49.3173" ixy="0" ixz="0" iyy="74.7699" iyz="0" izz="44.0125"/>
    </inertial>
  </link>

  <!-- Left Engine Link -->
  <link name="left_engine_link">
    <visual>
      <geometry>
        <mesh filename="package://autonomy_boat/models/engine/mesh/engine.dae" scale="0.75 0.75 1.25"/>
      </geometry>
    </visual>
    <collision name="left_engine_vertical_axis_collision">
      <origin rpy="0 0 0" xyz="-0.16 0 -0.24"/>
      <geometry>
        <box size="0.2 0.15 0.83"/>
      </geometry>
    </collision>
    <collision name="left_engine_rear_end_collision">
      <origin rpy="0 0 0" xyz="-0.34 0 0.12"/>
      <geometry>
        <box size="0.12 0.15 0.12"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="15"/>
      <inertia ixx="0.889245" ixy="0" ixz="0" iyy="0.911125" iyz="0" izz="0.078125"/>
    </inertial>
  </link>

  <!-- Left Propeller Link -->
  <link name="left_propeller_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://autonomy_boat/models/propeller/mesh/propeller.dae" scale="0.75 0.75 0.75"/>
      </geometry>
    </visual>
    <collision name="left_propeller_collision">
      <origin rpy="0 1.57 0" xyz="0 0.15 0"/>
      <geometry>
        <cylinder length="0.3" radius="0.24"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.5"/>
      <inertia ixx="0.008545" ixy="0" ixz="0" iyy="0.008545" iyz="0" izz="0.0144"/>
    </inertial>
  </link>

  <!-- Left Engine Joint -->
  <joint name="left_chasis_engine_joint" type="revolute">
    <origin rpy="0 0 0" xyz="-1.55 0.45 0"/>
    <parent link="base_link"/>
    <child link="left_engine_link"/>
    <axis xyz="0 0 1"/>
    <limit effort="10" velocity="10" lower="-3.14159" upper="3.14159"/>
  </joint>

  <!-- Left Propeller Joint -->
  <joint name="left_engine_propeller_joint" type="continuous">
    <origin rpy="0 0 0" xyz="-0.2 0 -0.63"/>
    <parent link="left_engine_link"/>
    <child link="left_propeller_link"/>
    <axis xyz="1 0 0"/>
    <limit effort="100" velocity="100"/>
    <dynamics damping="0.05" friction="0.05"/>
  </joint>

  <!-- Right Engine Link -->
  <link name="right_engine_link">
    <visual>
      <geometry>
        <mesh filename="package://autonomy_boat/models/engine/mesh/engine.dae" scale="0.75 0.75 1.25"/>
      </geometry>
    </visual>
    <collision name="right_engine_vertical_axis_collision">
      <origin rpy="0 0 0" xyz="-0.16 0 -0.24"/>
      <geometry>
        <box size="0.2 0.15 0.83"/>
      </geometry>
    </collision>
    <collision name="right_engine_rear_end_collision">
      <origin rpy="0 0 0" xyz="-0.34 0 0.12"/>
      <geometry>
        <box size="0.12 0.15 0.12"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="15"/>
      <inertia ixx="0.889245" ixy="0" ixz="0" iyy="0.911125" iyz="0" izz="0.078125"/>
    </inertial>
  </link>

  <!-- Right Propeller Link -->
  <link name="right_propeller_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://autonomy_boat/models/propeller/mesh/propeller.dae" scale="0.75 0.75 0.75"/>
      </geometry>
    </visual>
    <collision name="right_propeller_collision">
      <origin rpy="0 1.57 0" xyz="-0.08 -0.15 0"/>
      <geometry>
        <cylinder length="0.3" radius="0.24"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.5"/>
      <inertia ixx="0.008545" ixy="0" ixz="0" iyy="0.008545" iyz="0" izz="0.0144"/>
    </inertial>
  </link>

  <!-- Right Engine Joint -->
  <joint name="right_chasis_engine_joint" type="revolute">
    <origin rpy="0 0 0" xyz="-1.55 -0.45 0"/>
    <parent link="base_link"/>
    <child link="right_engine_link"/>
    <axis xyz="0 0 1"/>
    <limit effort="10" velocity="10" lower="-3.14159" upper="3.14159"/>
  </joint>

  <!-- Right Propeller Joint -->
  <joint name="right_engine_propeller_joint" type="continuous">
    <origin rpy="0 0 0" xyz="-0.2 0 -0.63"/>
    <parent link="right_engine_link"/>
    <child link="right_propeller_link"/>
    <axis xyz="1 0 0"/>
    <limit effort="100" velocity="100"/>
    <dynamics damping="0.05" friction="0.05"/>
  </joint>

  <!-- Gazebo plugins updated for ROS2 -->
  <gazebo>
    <plugin name="usv_thrust_plugin" filename="libusv_gazebo_thrust_plugin.so">
      <cmdTimeout>1.0</cmdTimeout>
      <thruster>
        <linkName>left_propeller_link</linkName>
        <propJointName>left_engine_propeller_joint</propJointName>
        <engineJointName>left_chasis_engine_joint</engineJointName>
        <cmdTopic>thrusters/left_thrust_cmd</cmdTopic>
        <angleTopic>thrusters/left_thrust_angle</angleTopic>
        <enableAngle>true</enableAngle>
        <mappingType>1</mappingType>
        <maxCmd>1.0</maxCmd>
        <maxForceFwd>250.0</maxForceFwd>
        <maxForceRev>-100.0</maxForceRev>
        <maxAngle>1.5708</maxAngle>
      </thruster>
      <thruster>
        <linkName>right_propeller_link</linkName>
        <propJointName>right_engine_propeller_joint</propJointName>
        <engineJointName>right_chasis_engine_joint</engineJointName>
        <cmdTopic>thrusters/right_thrust_cmd</cmdTopic>
        <angleTopic>thrusters/right_thrust_angle</angleTopic>
        <enableAngle>true</enableAngle>
        <mappingType>1</mappingType>
        <maxCmd>1.0</maxCmd>
        <maxForceFwd>250.0</maxForceFwd>
        <maxForceRev>-100.0